<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.10.0" />
<title>pycollector.dataset API documentation</title>
<meta name="description" content="" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}#lunr-search{width:100%;font-size:1em;padding:6px 9px 5px 9px;border:1px solid silver}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>pycollector.dataset</code></h1>
</header>
<section id="section-intro">
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L1-L187" class="git-link">Browse git</a>
</summary>
<pre><code class="python">import os
import numpy as np
from pycollector.globals import print
from vipy.util import findpkl, toextension, filepath, filebase, jsonlist, ishtml, ispkl, filetail, temphtml, listpkl, listext, templike, tempdir, remkdir, tolist, fileext, writelist, tempcsv, newpathroot, listjson, extlist, filefull, tempdir
import random
import vipy
import vipy.util
import shutil
import uuid
import warnings
import copy 
import atexit
from pycollector.util import is_email_address
import torch
from vipy.batch import Batch       
import hashlib
import torch.utils.data
from torch.utils.data import DataLoader, random_split
import pickle
import time
import json
import dill
import vipy.torch
import vipy.dataset

    
def disjoint_activities(V, activitylist):    
    assert all([isinstance(v, vipy.video.Video) for v in V])
    assert isinstance(activitylist, list) and len(activitylist)&gt;0 and len(activitylist[0]) == 2
    for (after, before) in activitylist:
        V = [v.activitymap(lambda a: a.disjoint([sa for sa in v.activitylist() if sa.category() == after]) if a.category() == before else a) for v in V]  
    V = [v.activityfilter(lambda a: len(a)&gt;0) for v in V]  # some activities may be zero length after disjoint
    return V


def asmeva(V):
    &#34;&#34;&#34;Convert a list of collector.dataset.Video() to MEVA annotation style&#34;&#34;&#34;
    assert all([isinstance(v, vipy.video.Scene) for v in V])
    
    # MEVA annotations assumptions:  https://docs.google.com/spreadsheets/d/19I3C5Zb6RHS0QC30nFT_m0ymArzjvlPLfb5SSRQYLUQ/edit#gid=0
    # Pad one second before, zero seconds after
    before1after0 = set([&#39;person_opens_facility_door&#39;, &#39;person_closes_facility_door&#39;, &#39;person_opens_car_door&#39;, &#39;person_closes_car_door&#39;, 
                         &#39;person_opens_car_trunk&#39;, &#39;person_opens_motorcycle_trunk&#39;, &#39;person_closes_car_trunk&#39;, &#39;person_closes_motorcycle_trunk&#39;,
                         &#39;car_stops&#39;, &#39;motorcycle_stops&#39;, &#39;person_interacts_with_laptop&#39;])        
    
    V = [v.activitymap(lambda a: a.temporalpad( (v.framerate()*1.0, 0) ) if a.category() in before1after0 else a) for v in V]
    
    # pad one second before, one second after, up to maximum of two seconds
    before1after1max2 = set([&#39;person_enters_scene_through_structure&#39;])
    V = [v.activitymap(lambda a: a.temporalpad(max(0, (v.framerate()*1.0)-len(a))) if a.category() in before1after1max2 else a) for v in V]
    
    # person_exits_scene_through_structure:  Pad one second before person_opens_facility_door label (if door collection), and ends with enough padding to make this minimum two seconds
    V = [v.activitymap(lambda a: (a.startframe(np.min([sa.startframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_opens_facility_door&#39;] + [a.startframe()]))
                                  .temporalpad( (0, 0) )  # padding is rolled into person_opens_*
                                  if a.category() == &#39;person_exits_scene_through_structure&#39; else a)) for v in V]        
    
    # person_enters_vehicle: Starts one second before person_opens_vehicle_door activity label and ends at the end of person_closes_vehicle_door activity, split motorcycles into separate class
    V = [v.activitymap(lambda a: (a.startframe(np.min([sa.startframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_opens_car_door&#39;] + [a.startframe()]))
                                  .endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_car_door&#39;] + [a.endframe()]))
                                  .temporalpad( (0, 0) )  # padding is rolled into person_opens_*
                                  if a.category() == &#39;person_enters_car&#39; else a)) for v in V]        
    
    # person_exits_vehicle:  Starts one second before person_opens_vehicle_door, and ends at person_exits_vehicle with enough padding to make this minimum two seconds, split motorcycles into separate class
    V = [v.activitymap(lambda a: (a.startframe(np.min([sa.startframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_opens_car_door&#39;] + [a.startframe()]))
                                  .endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_car_door&#39;] + [a.endframe()]))
                                  .temporalpad( (0, 0) )  # padding is rolled into person_opens_*
                                  if a.category() == &#39;person_exits_car&#39; else a)) for v in V]        
    
    # person_unloads_vehicle:  No padding before label start (the definition states one second of padding before cargo starts to move, but our label starts after the trunk is open, 
    # so there is a lag from opening to touching the cargo which we assume is at least 1sec), ends at the end of person_closes_trunk.
    V = [v.activitymap(lambda a: (a.endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_car_trunk&#39;] + [a.endframe()]))
                                  if a.category() == &#39;person_unloads_car&#39; else a)) for v in V]
    V = [v.activitymap(lambda a: (a.endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_motorcycle_trunk&#39;] + [a.endframe()]))
                                  if a.category() == &#39;person_unloads_motorcycle&#39; else a)) for v in V]
    
    # person_talks_to_person:  Equal padding to minimum of five seconds
    equal5 = set([&#39;person_talks_to_person&#39;, &#39;person_reads_document&#39;])
    V = [v.activitymap(lambda a: a.temporalpad(max(0, (v.framerate()*2.5)-len(a))) if a.category() in equal5 else a) for v in V]
    
    # person_texting_on_phone:  Equal padding to minimum of two seconds
    V = [v.activitymap(lambda a: a.temporalpad(max(0, (v.framerate()*1.0)-len(a))) if a.category() == &#39;person_texting_on_phone&#39; else a) for v in V]
    
    # Pad one second before, one second after
    before1after1 = set([&#39;car_turns_left&#39;, &#39;motorcycle_turns_left&#39;, &#39;car_turns_right&#39;, &#39;motorcycle_turns_right&#39;, &#39;person_transfers_object_to_person&#39;, &#39;person_transfers_object_to_vehicle&#39;,
                         &#39;person_sets_down_object&#39;, &#39;hand_interacts_with_person_handshake&#39;, &#39;hand_interacts_with_person_highfive&#39;, &#39;hand_interacts_with_person_holdhands&#39;, &#39;person_embraces_person&#39;, &#39;person_purchases&#39;,
                         &#39;car_picks_up_person&#39;, &#39;car_drops_off_person&#39;, &#39;motorcycle_drops_off_person&#39;, &#39;motorcycle_picks_up_person&#39;])
    V = [v.activitymap(lambda a: a.temporalpad(v.framerate()*1.0) if a.category() in before1after1 else a) for v in V]
    
    # Pad zero second before, one second after
    before0after1 = set([&#39;car_makes_u_turn&#39;, &#39;motorcycle_makes_u_turn&#39;, &#39;person_picks_up_object&#39;])  
    V = [v.activitymap(lambda a: a.temporalpad( (0, v.framerate()*1.0) ) if a.category() in before0after1 else a) for v in V]
    
    # person_abandons_package:  two seconds before, two seconds after
    V = [v.activitymap(lambda a: a.temporalpad(v.framerate()*2.0) if a.category() == &#39;person_abandons_package&#39; else a) for v in V]
    return V




class TorchDataset(vipy.torch.TorchDataset):
    &#34;&#34;&#34;Moved to vipy.torch.TorchDataset&#34;&#34;&#34;
    # vipy-1.11.7    
    pass

class TorchTensordir(vipy.torch.TorchTensordir):
    &#34;&#34;&#34;Moved to vipy.torch.TorchTensordir&#34;&#34;&#34;
    # vipy-1.11.7    
    pass

class Dataset(vipy.dataset.Dataset):
    &#34;&#34;&#34;Additional methods beyond `vipy.dataset.Dataset` that are specific to collector style datasets&#34;&#34;&#34;

    def collectors(self, outfile=None):
        assert self._isvipy()
        d = vipy.util.countby(self.list(), lambda v: v.attributes[&#39;collector_id&#39;])
        f = lambda x,n: len([k for (k,v) in d.items() if int(v) &gt;= n])
        print(&#39;[pycollector.dataset]: Collectors = %d &#39; % f(d,0))
        print(&#39;[pycollector.dataset]: Collectors with &gt;10 submissions = %d&#39; % f(d,10))
        print(&#39;[pycollector.dataset]: Collectors with &gt;100 submissions = %d&#39; % f(d,100))
        print(&#39;[pycollector.dataset]: Collectors with &gt;1000 submissions = %d&#39; % f(d,1000))
        print(&#39;[pycollector.dataset]: Collectors with &gt;10000 submissions = %d&#39; % f(d,10000))

        if outfile is not None:
            from vipy.metrics import histogram
            (k,v) = zip(*(sorted(d.items(), key=lambda x: x[1], reverse=True))) 
            histogram(v, list(range(len(k))), outfile=outfile, ylabel=&#39;Submissions&#39;, xlabel=&#39;Collector&#39;, xrot=&#39;vertical&#39;, fontsize=3, xshow=False)            
        return d

    def subjects(self, outfile=None):
        assert self._isvipy()
        d = vipy.util.countby(self.list(), lambda v: v.attributes[&#39;subject_ids&#39;][0] if v.hasattribute(&#39;subject_ids&#39;) and len(v.attributes[&#39;subject_ids&#39;])&gt;0 else None)
        f = lambda x,n: len([k for (k,v) in d.items() if int(v) &gt;= n])
        print(&#39;[pycollector.dataset]: Subjects = %d &#39; % f(d,0))
        print(&#39;[pycollector.dataset]: Subjects with &gt;10 submissions = %d&#39; % f(d,10))
        print(&#39;[pycollector.dataset]: Subjects with &gt;100 submissions = %d&#39; % f(d,100))
        print(&#39;[pycollector.dataset]: Subjects with &gt;1000 submissions = %d&#39; % f(d,1000))
        print(&#39;[pycollector.dataset]: Subjects with &gt;10000 submissions = %d&#39; % f(d,10000))

        if outfile is not None:
            from vipy.metrics import histogram
            (k,v) = zip(*(sorted(d.items(), key=lambda x: x[1], reverse=True))) 
            histogram(v, list(range(len(k))), outfile=outfile, ylabel=&#39;Submissions&#39;, xlabel=&#39;Subject&#39;, xrot=&#39;vertical&#39;, fontsize=3, xshow=False)            
        return d

    def os(self, outfile=None):
        assert self._isvipy()
        d = vipy.util.countby([v for v in self.list() if v.hasattribute(&#39;device_identifier&#39;)], lambda v: v.attributes[&#39;device_identifier&#39;])
        print(&#39;[vipy.dataset]: Device OS = %d &#39; % len(d))
        if outfile is not None:
            from vipy.metrics import pie
            pie(d.values(), d.keys(), explode=None, outfile=outfile,  shadow=False)
        return d

    def device(self, outfile=None, n=24, fontsize=7):
        assert self._isvipy()
        d_all = vipy.util.countby([v for v in self.list() if v.hasattribute(&#39;device_type&#39;) and v.attributes[&#39;device_type&#39;] != &#39;unrecognized&#39;], lambda v: v.attributes[&#39;device_type&#39;])
        
        topk = [k for (k,v) in sorted(list(d_all.items()), key=lambda x: x[1])[-n:]] 
        other = np.sum([v for (k,v) in d_all.items() if k not in set(topk)])

        d = {k:v for (k,v) in d_all.items() if k in set(topk)}
        d.update( {&#39;Other&#39;:other} )
        d = dict(sorted(list(d.items()), key=lambda x: x[1]))

        print(&#39;[vipy.dataset.device]: Device types = %d &#39; % len(d_all))
        print(&#39;[vipy.dataset.device]: Top-%d Device types = %s &#39; % (n, str(topk)))

        if outfile is not None:
            from vipy.metrics import pie
            pie(d.values(), d.keys(), explode=None, outfile=outfile,  shadow=False, legend=False, fontsize=fontsize, rotatelabels=False)
        return d
        

    def geolocation(self, outfile=None):
        assert self._isvipy()
        
        L = [v for v in self if &#39;ipAddress&#39; in v.metadata()]
        L = [v[0].geolocation() for (k,v) in vipy.util.groupbyasdict(L, lambda v: v.collectorid()).items()]
        L = [v for v in L if v is not None]
        return {&#39;country&#39;: vipy.util.countby(L, lambda d: str(d[&#39;countryname&#39;])),
                &#39;city&#39;: vipy.util.countby(L, lambda d: str(d[&#39;city&#39;]))}
                
    @classmethod
    def cast(cls, D):
        assert isinstance(D, vipy.dataset.Dataset), &#34;Invalid input - must be derived from vipy.dataset.Dataset&#34;
        return cls(list(D))
        </code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="pycollector.dataset.asmeva"><code class="name flex">
<span>def <span class="ident">asmeva</span></span>(<span>V)</span>
</code></dt>
<dd>
<div class="desc"><p>Convert a list of collector.dataset.Video() to MEVA annotation style</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L36-L95" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def asmeva(V):
    &#34;&#34;&#34;Convert a list of collector.dataset.Video() to MEVA annotation style&#34;&#34;&#34;
    assert all([isinstance(v, vipy.video.Scene) for v in V])
    
    # MEVA annotations assumptions:  https://docs.google.com/spreadsheets/d/19I3C5Zb6RHS0QC30nFT_m0ymArzjvlPLfb5SSRQYLUQ/edit#gid=0
    # Pad one second before, zero seconds after
    before1after0 = set([&#39;person_opens_facility_door&#39;, &#39;person_closes_facility_door&#39;, &#39;person_opens_car_door&#39;, &#39;person_closes_car_door&#39;, 
                         &#39;person_opens_car_trunk&#39;, &#39;person_opens_motorcycle_trunk&#39;, &#39;person_closes_car_trunk&#39;, &#39;person_closes_motorcycle_trunk&#39;,
                         &#39;car_stops&#39;, &#39;motorcycle_stops&#39;, &#39;person_interacts_with_laptop&#39;])        
    
    V = [v.activitymap(lambda a: a.temporalpad( (v.framerate()*1.0, 0) ) if a.category() in before1after0 else a) for v in V]
    
    # pad one second before, one second after, up to maximum of two seconds
    before1after1max2 = set([&#39;person_enters_scene_through_structure&#39;])
    V = [v.activitymap(lambda a: a.temporalpad(max(0, (v.framerate()*1.0)-len(a))) if a.category() in before1after1max2 else a) for v in V]
    
    # person_exits_scene_through_structure:  Pad one second before person_opens_facility_door label (if door collection), and ends with enough padding to make this minimum two seconds
    V = [v.activitymap(lambda a: (a.startframe(np.min([sa.startframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_opens_facility_door&#39;] + [a.startframe()]))
                                  .temporalpad( (0, 0) )  # padding is rolled into person_opens_*
                                  if a.category() == &#39;person_exits_scene_through_structure&#39; else a)) for v in V]        
    
    # person_enters_vehicle: Starts one second before person_opens_vehicle_door activity label and ends at the end of person_closes_vehicle_door activity, split motorcycles into separate class
    V = [v.activitymap(lambda a: (a.startframe(np.min([sa.startframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_opens_car_door&#39;] + [a.startframe()]))
                                  .endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_car_door&#39;] + [a.endframe()]))
                                  .temporalpad( (0, 0) )  # padding is rolled into person_opens_*
                                  if a.category() == &#39;person_enters_car&#39; else a)) for v in V]        
    
    # person_exits_vehicle:  Starts one second before person_opens_vehicle_door, and ends at person_exits_vehicle with enough padding to make this minimum two seconds, split motorcycles into separate class
    V = [v.activitymap(lambda a: (a.startframe(np.min([sa.startframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_opens_car_door&#39;] + [a.startframe()]))
                                  .endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_car_door&#39;] + [a.endframe()]))
                                  .temporalpad( (0, 0) )  # padding is rolled into person_opens_*
                                  if a.category() == &#39;person_exits_car&#39; else a)) for v in V]        
    
    # person_unloads_vehicle:  No padding before label start (the definition states one second of padding before cargo starts to move, but our label starts after the trunk is open, 
    # so there is a lag from opening to touching the cargo which we assume is at least 1sec), ends at the end of person_closes_trunk.
    V = [v.activitymap(lambda a: (a.endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_car_trunk&#39;] + [a.endframe()]))
                                  if a.category() == &#39;person_unloads_car&#39; else a)) for v in V]
    V = [v.activitymap(lambda a: (a.endframe(np.max([sa.endframe() for sa in v.activities().values() if sa.isneighbor(a) and sa.category() == &#39;person_closes_motorcycle_trunk&#39;] + [a.endframe()]))
                                  if a.category() == &#39;person_unloads_motorcycle&#39; else a)) for v in V]
    
    # person_talks_to_person:  Equal padding to minimum of five seconds
    equal5 = set([&#39;person_talks_to_person&#39;, &#39;person_reads_document&#39;])
    V = [v.activitymap(lambda a: a.temporalpad(max(0, (v.framerate()*2.5)-len(a))) if a.category() in equal5 else a) for v in V]
    
    # person_texting_on_phone:  Equal padding to minimum of two seconds
    V = [v.activitymap(lambda a: a.temporalpad(max(0, (v.framerate()*1.0)-len(a))) if a.category() == &#39;person_texting_on_phone&#39; else a) for v in V]
    
    # Pad one second before, one second after
    before1after1 = set([&#39;car_turns_left&#39;, &#39;motorcycle_turns_left&#39;, &#39;car_turns_right&#39;, &#39;motorcycle_turns_right&#39;, &#39;person_transfers_object_to_person&#39;, &#39;person_transfers_object_to_vehicle&#39;,
                         &#39;person_sets_down_object&#39;, &#39;hand_interacts_with_person_handshake&#39;, &#39;hand_interacts_with_person_highfive&#39;, &#39;hand_interacts_with_person_holdhands&#39;, &#39;person_embraces_person&#39;, &#39;person_purchases&#39;,
                         &#39;car_picks_up_person&#39;, &#39;car_drops_off_person&#39;, &#39;motorcycle_drops_off_person&#39;, &#39;motorcycle_picks_up_person&#39;])
    V = [v.activitymap(lambda a: a.temporalpad(v.framerate()*1.0) if a.category() in before1after1 else a) for v in V]
    
    # Pad zero second before, one second after
    before0after1 = set([&#39;car_makes_u_turn&#39;, &#39;motorcycle_makes_u_turn&#39;, &#39;person_picks_up_object&#39;])  
    V = [v.activitymap(lambda a: a.temporalpad( (0, v.framerate()*1.0) ) if a.category() in before0after1 else a) for v in V]
    
    # person_abandons_package:  two seconds before, two seconds after
    V = [v.activitymap(lambda a: a.temporalpad(v.framerate()*2.0) if a.category() == &#39;person_abandons_package&#39; else a) for v in V]
    return V</code></pre>
</details>
</dd>
<dt id="pycollector.dataset.disjoint_activities"><code class="name flex">
<span>def <span class="ident">disjoint_activities</span></span>(<span>V, activitylist)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L27-L33" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def disjoint_activities(V, activitylist):    
    assert all([isinstance(v, vipy.video.Video) for v in V])
    assert isinstance(activitylist, list) and len(activitylist)&gt;0 and len(activitylist[0]) == 2
    for (after, before) in activitylist:
        V = [v.activitymap(lambda a: a.disjoint([sa for sa in v.activitylist() if sa.category() == after]) if a.category() == before else a) for v in V]  
    V = [v.activityfilter(lambda a: len(a)&gt;0) for v in V]  # some activities may be zero length after disjoint
    return V</code></pre>
</details>
</dd>
</dl>
</section>
<section>
<h2 class="section-title" id="header-classes">Classes</h2>
<dl>
<dt id="pycollector.dataset.Dataset"><code class="flex name class">
<span>class <span class="ident">Dataset</span></span>
<span>(</span><span>objlist, id=None, abspath=True, loader=None, lazy=False)</span>
</code></dt>
<dd>
<div class="desc"><p>Additional methods beyond <code>vipy.dataset.Dataset</code> that are specific to collector style datasets</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L110-L186" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class Dataset(vipy.dataset.Dataset):
    &#34;&#34;&#34;Additional methods beyond `vipy.dataset.Dataset` that are specific to collector style datasets&#34;&#34;&#34;

    def collectors(self, outfile=None):
        assert self._isvipy()
        d = vipy.util.countby(self.list(), lambda v: v.attributes[&#39;collector_id&#39;])
        f = lambda x,n: len([k for (k,v) in d.items() if int(v) &gt;= n])
        print(&#39;[pycollector.dataset]: Collectors = %d &#39; % f(d,0))
        print(&#39;[pycollector.dataset]: Collectors with &gt;10 submissions = %d&#39; % f(d,10))
        print(&#39;[pycollector.dataset]: Collectors with &gt;100 submissions = %d&#39; % f(d,100))
        print(&#39;[pycollector.dataset]: Collectors with &gt;1000 submissions = %d&#39; % f(d,1000))
        print(&#39;[pycollector.dataset]: Collectors with &gt;10000 submissions = %d&#39; % f(d,10000))

        if outfile is not None:
            from vipy.metrics import histogram
            (k,v) = zip(*(sorted(d.items(), key=lambda x: x[1], reverse=True))) 
            histogram(v, list(range(len(k))), outfile=outfile, ylabel=&#39;Submissions&#39;, xlabel=&#39;Collector&#39;, xrot=&#39;vertical&#39;, fontsize=3, xshow=False)            
        return d

    def subjects(self, outfile=None):
        assert self._isvipy()
        d = vipy.util.countby(self.list(), lambda v: v.attributes[&#39;subject_ids&#39;][0] if v.hasattribute(&#39;subject_ids&#39;) and len(v.attributes[&#39;subject_ids&#39;])&gt;0 else None)
        f = lambda x,n: len([k for (k,v) in d.items() if int(v) &gt;= n])
        print(&#39;[pycollector.dataset]: Subjects = %d &#39; % f(d,0))
        print(&#39;[pycollector.dataset]: Subjects with &gt;10 submissions = %d&#39; % f(d,10))
        print(&#39;[pycollector.dataset]: Subjects with &gt;100 submissions = %d&#39; % f(d,100))
        print(&#39;[pycollector.dataset]: Subjects with &gt;1000 submissions = %d&#39; % f(d,1000))
        print(&#39;[pycollector.dataset]: Subjects with &gt;10000 submissions = %d&#39; % f(d,10000))

        if outfile is not None:
            from vipy.metrics import histogram
            (k,v) = zip(*(sorted(d.items(), key=lambda x: x[1], reverse=True))) 
            histogram(v, list(range(len(k))), outfile=outfile, ylabel=&#39;Submissions&#39;, xlabel=&#39;Subject&#39;, xrot=&#39;vertical&#39;, fontsize=3, xshow=False)            
        return d

    def os(self, outfile=None):
        assert self._isvipy()
        d = vipy.util.countby([v for v in self.list() if v.hasattribute(&#39;device_identifier&#39;)], lambda v: v.attributes[&#39;device_identifier&#39;])
        print(&#39;[vipy.dataset]: Device OS = %d &#39; % len(d))
        if outfile is not None:
            from vipy.metrics import pie
            pie(d.values(), d.keys(), explode=None, outfile=outfile,  shadow=False)
        return d

    def device(self, outfile=None, n=24, fontsize=7):
        assert self._isvipy()
        d_all = vipy.util.countby([v for v in self.list() if v.hasattribute(&#39;device_type&#39;) and v.attributes[&#39;device_type&#39;] != &#39;unrecognized&#39;], lambda v: v.attributes[&#39;device_type&#39;])
        
        topk = [k for (k,v) in sorted(list(d_all.items()), key=lambda x: x[1])[-n:]] 
        other = np.sum([v for (k,v) in d_all.items() if k not in set(topk)])

        d = {k:v for (k,v) in d_all.items() if k in set(topk)}
        d.update( {&#39;Other&#39;:other} )
        d = dict(sorted(list(d.items()), key=lambda x: x[1]))

        print(&#39;[vipy.dataset.device]: Device types = %d &#39; % len(d_all))
        print(&#39;[vipy.dataset.device]: Top-%d Device types = %s &#39; % (n, str(topk)))

        if outfile is not None:
            from vipy.metrics import pie
            pie(d.values(), d.keys(), explode=None, outfile=outfile,  shadow=False, legend=False, fontsize=fontsize, rotatelabels=False)
        return d
        

    def geolocation(self, outfile=None):
        assert self._isvipy()
        
        L = [v for v in self if &#39;ipAddress&#39; in v.metadata()]
        L = [v[0].geolocation() for (k,v) in vipy.util.groupbyasdict(L, lambda v: v.collectorid()).items()]
        L = [v for v in L if v is not None]
        return {&#39;country&#39;: vipy.util.countby(L, lambda d: str(d[&#39;countryname&#39;])),
                &#39;city&#39;: vipy.util.countby(L, lambda d: str(d[&#39;city&#39;]))}
                
    @classmethod
    def cast(cls, D):
        assert isinstance(D, vipy.dataset.Dataset), &#34;Invalid input - must be derived from vipy.dataset.Dataset&#34;
        return cls(list(D))</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>vipy.dataset.Dataset</li>
</ul>
<h3>Static methods</h3>
<dl>
<dt id="pycollector.dataset.Dataset.cast"><code class="name flex">
<span>def <span class="ident">cast</span></span>(<span>D)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L183-L186" class="git-link">Browse git</a>
</summary>
<pre><code class="python">@classmethod
def cast(cls, D):
    assert isinstance(D, vipy.dataset.Dataset), &#34;Invalid input - must be derived from vipy.dataset.Dataset&#34;
    return cls(list(D))</code></pre>
</details>
</dd>
</dl>
<h3>Methods</h3>
<dl>
<dt id="pycollector.dataset.Dataset.collectors"><code class="name flex">
<span>def <span class="ident">collectors</span></span>(<span>self, outfile=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L113-L127" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def collectors(self, outfile=None):
    assert self._isvipy()
    d = vipy.util.countby(self.list(), lambda v: v.attributes[&#39;collector_id&#39;])
    f = lambda x,n: len([k for (k,v) in d.items() if int(v) &gt;= n])
    print(&#39;[pycollector.dataset]: Collectors = %d &#39; % f(d,0))
    print(&#39;[pycollector.dataset]: Collectors with &gt;10 submissions = %d&#39; % f(d,10))
    print(&#39;[pycollector.dataset]: Collectors with &gt;100 submissions = %d&#39; % f(d,100))
    print(&#39;[pycollector.dataset]: Collectors with &gt;1000 submissions = %d&#39; % f(d,1000))
    print(&#39;[pycollector.dataset]: Collectors with &gt;10000 submissions = %d&#39; % f(d,10000))

    if outfile is not None:
        from vipy.metrics import histogram
        (k,v) = zip(*(sorted(d.items(), key=lambda x: x[1], reverse=True))) 
        histogram(v, list(range(len(k))), outfile=outfile, ylabel=&#39;Submissions&#39;, xlabel=&#39;Collector&#39;, xrot=&#39;vertical&#39;, fontsize=3, xshow=False)            
    return d</code></pre>
</details>
</dd>
<dt id="pycollector.dataset.Dataset.device"><code class="name flex">
<span>def <span class="ident">device</span></span>(<span>self, outfile=None, n=24, fontsize=7)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L154-L171" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def device(self, outfile=None, n=24, fontsize=7):
    assert self._isvipy()
    d_all = vipy.util.countby([v for v in self.list() if v.hasattribute(&#39;device_type&#39;) and v.attributes[&#39;device_type&#39;] != &#39;unrecognized&#39;], lambda v: v.attributes[&#39;device_type&#39;])
    
    topk = [k for (k,v) in sorted(list(d_all.items()), key=lambda x: x[1])[-n:]] 
    other = np.sum([v for (k,v) in d_all.items() if k not in set(topk)])

    d = {k:v for (k,v) in d_all.items() if k in set(topk)}
    d.update( {&#39;Other&#39;:other} )
    d = dict(sorted(list(d.items()), key=lambda x: x[1]))

    print(&#39;[vipy.dataset.device]: Device types = %d &#39; % len(d_all))
    print(&#39;[vipy.dataset.device]: Top-%d Device types = %s &#39; % (n, str(topk)))

    if outfile is not None:
        from vipy.metrics import pie
        pie(d.values(), d.keys(), explode=None, outfile=outfile,  shadow=False, legend=False, fontsize=fontsize, rotatelabels=False)
    return d</code></pre>
</details>
</dd>
<dt id="pycollector.dataset.Dataset.geolocation"><code class="name flex">
<span>def <span class="ident">geolocation</span></span>(<span>self, outfile=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L174-L181" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def geolocation(self, outfile=None):
    assert self._isvipy()
    
    L = [v for v in self if &#39;ipAddress&#39; in v.metadata()]
    L = [v[0].geolocation() for (k,v) in vipy.util.groupbyasdict(L, lambda v: v.collectorid()).items()]
    L = [v for v in L if v is not None]
    return {&#39;country&#39;: vipy.util.countby(L, lambda d: str(d[&#39;countryname&#39;])),
            &#39;city&#39;: vipy.util.countby(L, lambda d: str(d[&#39;city&#39;]))}</code></pre>
</details>
</dd>
<dt id="pycollector.dataset.Dataset.os"><code class="name flex">
<span>def <span class="ident">os</span></span>(<span>self, outfile=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L145-L152" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def os(self, outfile=None):
    assert self._isvipy()
    d = vipy.util.countby([v for v in self.list() if v.hasattribute(&#39;device_identifier&#39;)], lambda v: v.attributes[&#39;device_identifier&#39;])
    print(&#39;[vipy.dataset]: Device OS = %d &#39; % len(d))
    if outfile is not None:
        from vipy.metrics import pie
        pie(d.values(), d.keys(), explode=None, outfile=outfile,  shadow=False)
    return d</code></pre>
</details>
</dd>
<dt id="pycollector.dataset.Dataset.subjects"><code class="name flex">
<span>def <span class="ident">subjects</span></span>(<span>self, outfile=None)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L129-L143" class="git-link">Browse git</a>
</summary>
<pre><code class="python">def subjects(self, outfile=None):
    assert self._isvipy()
    d = vipy.util.countby(self.list(), lambda v: v.attributes[&#39;subject_ids&#39;][0] if v.hasattribute(&#39;subject_ids&#39;) and len(v.attributes[&#39;subject_ids&#39;])&gt;0 else None)
    f = lambda x,n: len([k for (k,v) in d.items() if int(v) &gt;= n])
    print(&#39;[pycollector.dataset]: Subjects = %d &#39; % f(d,0))
    print(&#39;[pycollector.dataset]: Subjects with &gt;10 submissions = %d&#39; % f(d,10))
    print(&#39;[pycollector.dataset]: Subjects with &gt;100 submissions = %d&#39; % f(d,100))
    print(&#39;[pycollector.dataset]: Subjects with &gt;1000 submissions = %d&#39; % f(d,1000))
    print(&#39;[pycollector.dataset]: Subjects with &gt;10000 submissions = %d&#39; % f(d,10000))

    if outfile is not None:
        from vipy.metrics import histogram
        (k,v) = zip(*(sorted(d.items(), key=lambda x: x[1], reverse=True))) 
        histogram(v, list(range(len(k))), outfile=outfile, ylabel=&#39;Submissions&#39;, xlabel=&#39;Subject&#39;, xrot=&#39;vertical&#39;, fontsize=3, xshow=False)            
    return d</code></pre>
</details>
</dd>
</dl>
</dd>
<dt id="pycollector.dataset.TorchDataset"><code class="flex name class">
<span>class <span class="ident">TorchDataset</span></span>
<span>(</span><span>f_transformer, d)</span>
</code></dt>
<dd>
<div class="desc"><p>Moved to vipy.torch.TorchDataset</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L100-L103" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TorchDataset(vipy.torch.TorchDataset):
    &#34;&#34;&#34;Moved to vipy.torch.TorchDataset&#34;&#34;&#34;
    # vipy-1.11.7    
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>vipy.torch.TorchDataset</li>
<li>torch.utils.data.dataset.Dataset</li>
<li>typing.Generic</li>
</ul>
</dd>
<dt id="pycollector.dataset.TorchTensordir"><code class="flex name class">
<span>class <span class="ident">TorchTensordir</span></span>
<span>(</span><span>tensordir, verbose=True, reseed=True, take=None, mutator=None)</span>
</code></dt>
<dd>
<div class="desc"><p>Moved to vipy.torch.TorchTensordir</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
<a href="https://github.com/visym/collector/blob/b6763ced3cbb1222a55b679dfc9d30337004b343/pycollector/dataset.py#L105-L108" class="git-link">Browse git</a>
</summary>
<pre><code class="python">class TorchTensordir(vipy.torch.TorchTensordir):
    &#34;&#34;&#34;Moved to vipy.torch.TorchTensordir&#34;&#34;&#34;
    # vipy-1.11.7    
    pass</code></pre>
</details>
<h3>Ancestors</h3>
<ul class="hlist">
<li>vipy.torch.TorchTensordir</li>
<li>vipy.torch.Tensordir</li>
<li>torch.utils.data.dataset.Dataset</li>
<li>typing.Generic</li>
</ul>
</dd>
</dl>
</section>
</article>
<nav id="sidebar">
<header>
<a class="homelink" rel="home" title="Visym Collector" href="https://github.com/visym/collector/">
<img src="https://www.visym.com/labs/images/visym_logo_black_notext.png" alt="" width="150"> <p> </p>
</a>
</header>
<form>
<input id="lunr-search" name="q" placeholder="🔎 Search ..." aria-label="Search"
disabled minlength="2">
</form>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.css" integrity="sha512-j1u8eUJ4f23xPPxwOrLUPQaCD2dwzNqqmDDcWS4deWsMv2ohLqmXXuP3hU7g8TyzbMSakP/mMqoNBYWj8AEIFg==" crossorigin>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tingle/0.15.3/tingle.min.js" integrity="sha512-plGUER9JkeEWPPqQBE4sdLqBoQug5Ap+BCGMc7bJ8BXkm+VVj6QzkpBz5Yv2yPkkq+cqg9IpkBaGCas6uDbW8g==" crossorigin></script>
<style>
.modal-dialog iframe {
width: 100vw;
height: calc(100vh - 80px);
}
@media screen and (min-width: 700px) {
.modal-dialog iframe {
width: 70vw;
height: 80vh;
}
}
.modal-dialog .tingle-modal-box {width: auto;}
.modal-dialog .tingle-modal-box__content {padding: 0;}
</style>
<script>
const input = document.getElementById('lunr-search');
input.disabled = false;
input.form.addEventListener('submit', (ev) => {
ev.preventDefault();
const url = new URL(window.location);
url.searchParams.set('q', input.value);
history.replaceState({}, null, url.toString());
search(input.value);
});
const query = new URL(window.location).searchParams.get('q');
if (query)
search(query);
function search(query) {
const url = '../doc-search.html#' + encodeURIComponent(query);
new tingle.modal({
cssClass: ['modal-dialog'],
onClose: () => {
const url = new URL(window.location);
url.searchParams.delete('q');
history.replaceState({}, null, url.toString());
setTimeout(() => input.focus(), 100);
}
}).setContent('<iframe src="' + url + '"></iframe>').open();
}
</script>
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="pycollector" href="index.html">pycollector</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="">
<li><code><a title="pycollector.dataset.asmeva" href="#pycollector.dataset.asmeva">asmeva</a></code></li>
<li><code><a title="pycollector.dataset.disjoint_activities" href="#pycollector.dataset.disjoint_activities">disjoint_activities</a></code></li>
</ul>
</li>
<li><h3><a href="#header-classes">Classes</a></h3>
<ul>
<li>
<h4><code><a title="pycollector.dataset.Dataset" href="#pycollector.dataset.Dataset">Dataset</a></code></h4>
<ul class="two-column">
<li><code><a title="pycollector.dataset.Dataset.cast" href="#pycollector.dataset.Dataset.cast">cast</a></code></li>
<li><code><a title="pycollector.dataset.Dataset.collectors" href="#pycollector.dataset.Dataset.collectors">collectors</a></code></li>
<li><code><a title="pycollector.dataset.Dataset.device" href="#pycollector.dataset.Dataset.device">device</a></code></li>
<li><code><a title="pycollector.dataset.Dataset.geolocation" href="#pycollector.dataset.Dataset.geolocation">geolocation</a></code></li>
<li><code><a title="pycollector.dataset.Dataset.os" href="#pycollector.dataset.Dataset.os">os</a></code></li>
<li><code><a title="pycollector.dataset.Dataset.subjects" href="#pycollector.dataset.Dataset.subjects">subjects</a></code></li>
</ul>
</li>
<li>
<h4><code><a title="pycollector.dataset.TorchDataset" href="#pycollector.dataset.TorchDataset">TorchDataset</a></code></h4>
</li>
<li>
<h4><code><a title="pycollector.dataset.TorchTensordir" href="#pycollector.dataset.TorchTensordir">TorchTensordir</a></code></h4>
</li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc" title="pdoc: Python API documentation generator"><cite>pdoc</cite> 0.10.0</a>.</p>
</footer>
</body>
</html>